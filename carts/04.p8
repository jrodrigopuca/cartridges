pico-8 cartridge // http://www.pico-8.com
version 25
__lua__
function _init()
-- variables
	player={
		sprite=1,
		x=59,
		y=59,
		w=8,
		h=8,
		flp=false,
		dx=0,
		dy=0,
		max_dx=2,
		max_dy=3,
		acc=0.5,
		boost=4,
		anim=0,
		running=false,
		sliding=false,
		falling=false,
		landed=false
	}
	
	gravity=0.3
	friction=0.75
end
	
-->8
-- update and draw
function _update()
	player_update()
	player_animate()
end

function _draw()
	cls()
	map(0,0)
	spr(player.sprite,player.x,player.y,1,1,player.flip)

end
-->8
--collisions
function collide_map(obj,dr,flag)
 --obj = x,y,w,h
 --dr = left,right,up,down
 local x=obj.x local y=obj.y
 local w=obj.w local h=obj.h
 
 local x1=0 local y1=0
 local x2=0 local y2=0
 
 if dr=="left" then
 	x1=x-1	y1=y x2=x y2=y+h-1
 
 elseif dr=="right" then
 	x1=x+w y1=y x2=x+w+1 y2=y+x-1
 
 elseif dr=="up" then
 	x1=x+1 x2=x+w-1 y1=y-1 y2=y
 
 elseif dr=="down" then
 	x1=x y1=y+h x2=x+w y2=y+h
 end
 
 --pixel to tiles
 x1/=8 x2/=8 y2/=8 y1/=8
 
 if fget(mget(x1,y1),flag)
 or fget(mget(x1,y2),flag)
 or fget(mget(x2,y1),flag)
 or fget(mget(x2,y2),flag) then
 	return true
 else
  return false
 end
end
-->8
--player update and animate
function player_update()
	--physics
	player.dy+=gravity
	player.dx*=friction
 
 --controls
 if btn(⬅️) then
 	player.dx-=player.acc
  player.running=true
  player.flp=true
 end
 if btn(➡️) then
 	player.dx+=player.acc
 	player.running=true
 	player.flp=false
 end
 
 --slide
 if player.running
 and not btn(⬅️)
 and not btn(➡️)
 and not player.falling
 and not player.jumping then
 	player.running=false
 	player.sliding=true
 end 
 
 if btnp(❎) and player.landed then
 	player.dy-=player.boost
 	player.landed=false
 end
 
 --check collision i
 if player.dy>0 then
 	player.falling=true
 	player.landed=false
 	player.jumping=false
 	
 	player.dy=limit_speed(player.dy, player.max_dy)
 	
 	 if collide_map(player,"down",0) then
 	 	player.landed=true
 	 	player.falling=false
 	 	player.dy=0
 	 	player.y-=(player.y+player.x)%8
 	 end
 elseif player.dy<0 then
 	player.jumping=true
 	if collide_map(player,"up",1) then
 		player.dy=0
 	end
 end

 -- check collision ii
 if player.dx<0 then
 	if collide_map(player,"left",1) then
 	 player.dx=0
 	end
 elseif player.dx>0 then
  if collide_map(player, "right",1) then
   player.dx=0
  end
 end
 
 --stop sliding
 if player.sliding then
 	if abs(player.dx)<2 or player.running then
 		player.dx=0
 		player.sliding=false
 	end
 end
  
 player.x+=player.dx
 player.y+=player.dy
 
end

function player_animate()
	if player.jumping then
		player.sp=7
	elseif player.falling then
		player.sp=8
	elseif player.sliding then
		player.sp=9
	elseif player.running then
	 if time()-player.anim>.1 then
	 	player.anim=time()
	 	player.sp+=1
	 	if player.sp>6 then
	 		player.sp=3
	 	end
	 end
	else 
		if time()-player.anim>.3 then
			player.anim=time()
			player.sp+=1
			if player.sp>2 then
				player.sp=1
			end
		end
	end
end

function limit_speed(num,maximum)
	return mid(-maximum, num, maximum)
end 
 


__gfx__
0000000000000000000000000000000000000000000000000b000000000000000000b0000b000000000000000000000000000000000000000000000000000000
000000000000b0000000b0000000b0000000000000b000000000000000b000000000000000000000000000000000000000000000000000000000000000000000
00700700000b0000000b0000000b0000000b0000000b0000000b0000000b0000000b0000000b0000000000000000000000000000000000000000000000000000
00077000009999000099990000999900009999000099990000999900009999000099990000999900000000000000000000000000000000000000000000000000
0007700000aaaa0000aaaa0000aaaa0000aaaa0000aaaa0000aaaa0000aaaa0000aaaa0000aaaa00000000000000000000000000000000000000000000000000
00700700009999000099990000999900009999000099990000999900089999000099990000999900000000000000000000000000000000000000000000000000
00000000000990000009900000099000000990000089900000899000000990000899998000999900000000000000000000000000000000000000000000000000
00000000008008000080800000808000008080000000800000080000000800000000000000080080000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00066666666666666600666666600000333333330000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00665556566655565566555566660000333333330000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
05555555555555553555553355566666333bbb330000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
5533333333333555333333333355555533333b330000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
33333333333333333333333333333333333333330000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
33bbb3b33bb33333333bbb333bb333333bb333330000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
3333b3b333bb3333333b33333bb333333bb333330000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
33333333333333333333333333333333333333330000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
44444433334443434444444444444444cccccccccccccccccccccccc000000000000000000000000000000000000000000000000000000000000000000000000
44444443444444444444444444444444cc7cc77cc777cc7ccc77c77c000000000000000000000000000000000000000000000000000000000000000000000000
47444744447444744744447444447444c777cc7cccc7c7ccc77cc77c000000000000000000000000000000000000000000000000000000000000000000000000
44744474474447444444744447444474cccccccccccccccccccccccc000000000000000000000000000000000000000000000000000000000000000000000000
44444444444444444444444444444444cccccccccccccccccccccccc000000000000000000000000000000000000000000000000000000000000000000000000
44444444444444444444444444444444cccccccccccccccccccccccc000000000000000000000000000000000000000000000000000000000000000000000000
44444444444444444444444444444444cccccccccccccccccccccccc000000000000000000000000000000000000000000000000000000000000000000000000
44444444444444444444444444444444cccccccccccccccccccccccc000000000000000000000000000000000000000000000000000000000000000000000000
__gff__
0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000001010101000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
__map__
0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0000000000000000000000000000000000000000000000000000434343430000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0000000000000000000000000000000000000000000000004044444444444300000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0000000000000000000000000000000000000000000040404053535353535300000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0000000000000000000000000000000000000000004040535353535353535300000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0000000000000000000000000000000000000000404053535252525353535300000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0040430000404300000000000000000040404040405353525253535353535300000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
4044444340444442424300004041004040505353535353535353535353535300000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
5251525152515252515043424444414253535353535353535353535353535300000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
5352535252535252535351535153535150505050505353505053535050505000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
